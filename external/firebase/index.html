<!DOCTYPE html>
<html ng-app="myApp">

<head>
  <!-- SCROLLS -->
  <link rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css" />
  <link rel="stylesheet" href="http://netdna.bootstrapcdn.com/font-awesome/4.0.0/css/font-awesome.css" />
  <link rel="stylesheet" href="style.css">
  <script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
   <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.0-beta.17/angular.min.js"></script>
    <script src="https://cdn.firebase.com/js/client/1.0.15/firebase.js"></script>
    <script src="https://cdn.firebase.com/libs/angularfire/0.8.0/angularfire.min.js"></script>
</head>
<style>
.panel-body {
	max-height: 350px;
	overflow-y: auto;
}
</style>
<script type="text/javascript">
(function($){  
 $.fn.limita = function(options) {  
 
 	var defaults = {
		limit: 200,
		id_result: false,
		alertClass: false
	}
 
 	var options = $.extend(defaults, options);
 
    return this.each(function() {  
 
	var	characters = options.limit;
	
	if(options.id_result != false)
	{
		$("#"+options.id_result).append("You have <strong>"+ characters+"</strong> characters");
	}
	
	$(this).keyup(function(){
		if($(this).val().length > characters){
		$(this).val($(this).val().substr(0, characters));
		}
		
		if(options.id_result != false)
		{
		
			var remaining = characters - $(this).val().length;
			$("#"+options.id_result).html("You have <strong>"+remaining+"</strong> characters");
		
			if(remaining <= 10)
			{
				$("#"+options.id_result).addClass(options.alertClass);
			}
			else
			{
				$("#"+options.id_result).removeClass(options.alertClass);
			}
		}
	});
 
});  
 };  
})(jQuery);
 
$(document).ready(function() {
  $("#messageInput").limita({
	limit: 50,
	id_result: "counter",
	alertClass: "alert"
});
	});
</script>
<body ng-controller="MyController">
<div class="container">
	<div class="row">
	<div class="panel panel-default">
		<div class="panel-heading">
			Angular JS & Firebase example
		</div>
		<div class="panel-body">
			 <ul id='example-messages' class='example-chat-messages'>
        <li ng-repeat='(body, msg) in messages'>
          <strong class='example-chat-username'>{{msg.from}}</strong>
          {{msg.body}}<!--<button ng-click="deleteMsg({{msg.$id}})">Delete</button>-->
        </li>
      </ul>
		</div>
		<div class="panel-body">
            <form accept-charset="UTF-8" action="" method="POST" ng-submit="submit()">
                <input class="col-md-12" ng-model='msg' ng-keydown="addMessage($event)" type='text' id='messageInput'  placeholder='Type a message...'>
                <div style="padding-top: 10px; padding-bottom: 10px;">
                <div id="counter" class="pull-right"></div>
                </div>
            </form>
        </div>
	</div>
</div>
<script>
      var myApp = angular.module("myApp", ["firebase"]);

      myApp.controller('MyController', ['$scope', '$firebase',
        function($scope, $firebase) {
          //CREATE A FIREBASE REFERENCE
          var ref = new Firebase("https://brilliant-fire-694.firebaseio.com");
          // GET MESSAGES AS AN ARRAY
          $scope.messages = $firebase(ref).$asArray();
		  
		  $scope.deleteMsg = function(id){
		  	  $scope.messages.$remove();
			  //ref.remove();
			}
          //ADD MESSAGE METHOD
          $scope.addMessage = function(e) {

            //LISTEN FOR RETURN KEY
            if (e.keyCode === 13 && $scope.msg) {
              //ALLOW CUSTOM OR ANONYMOUS USER NAMES
              var name = $scope.name || 'anonymous';

              //ADD TO FIREBASE
              $scope.messages.$add({
                from: name,
                body: $scope.msg
              });
              //RESET MESSAGE
              $scope.msg = "";
            }
          }
        }
      ]);
    </script>
</body>
</html>
